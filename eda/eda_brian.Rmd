---
title: "EDA"
author: "Brian Cochran"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_libraries}
library(tidyverse)
library(fpp3)
library(glmnet)
library(ggthemes)
library(patchwork)
theme_set(theme_economist())
```

```{r load_data}
sched2023 <- read.csv("~/MinneMudac-Rstans/data/2023_MLBSchedule.csv")
og_sched <- read.csv("~/MinneMudac-Rstans/data/OriginalSchedulesFixed.csv")
game_logs <- read.csv("~/MinneMudac-Rstans/data/GameLogsFixed.csv")
```

```{r eda-gamelogs}
game_logs %>%
  as_tibble() %>%
  mutate(Date=as.Date(as.character(Date), format="%Y%m%d")) %>%
  mutate(Attendance=Attendance/1000) %>%
  filter(year(Date)==2001) %>%
  ggplot(aes(x=Date, y=Attendance))+
  geom_point()

str(game_logs)
```

```{r twins_streaks_eda1}
twins_logs <- game_logs %>%
  filter(HomeTeam=="MIN" | VisitingTeam=="MIN", Attendance>0) %>%
  mutate(win=ifelse(HomeTeam=="MIN", HomeTeamScore>VistingTeamScore, VistingTeamScore>HomeTeamScore))

countStreaks <- function(wins){
  streaks <- rep(0, length(wins))
  count <- 0
  for (i in 2:length(wins)){
    if (wins[i-1] == TRUE) {
      count = count + 1
    } else {
      count = 0
    }
    streaks[i] = streaks[i] + count
  }
  return(streaks)
}

twins_logs <- twins_logs %>%
  mutate(streak = countStreaks(win))

cor(twins_logs$Attendance, twins_logs$streak)
twins_logs %>%
  ggplot(aes(x=streak, y= Attendance))+
  geom_point()+
  geom_smooth()
```

It looks like win streak is not going to be a good predictor of attendance because the correlation is very low and the plot shows an almost horizontal line.

```{r twins_streaks_eda2}
twins_logs %>%
  group_by(streak) %>%
  ggplot(aes(x=Attendance, y=as.factor(streak)))+
  geom_boxplot()
```

The boxplot shows that from a streak of 1-10 there is not much difference in attendance, but at 11 there is a significant difference in attendance. There is not as much data for streaks of 11, though, so this may not be reliable.

```{r allteams_streaks}
all_logs <- twins_logs
for (team in unique(game_logs$HomeTeam)){
  temp <- game_logs %>%
    filter(HomeTeam==team | VisitingTeam==team, Attendance>0) %>%
    mutate(win=ifelse(HomeTeam==team, HomeTeamScore>VistingTeamScore, VistingTeamScore>HomeTeamScore))
  temp <- temp %>%
    mutate(streak=countStreaks(win))
  all_logs <- rbind(all_logs, temp)
}
all_logs <- all_logs %>%
  select(-win)

(all_logs %>%
  ggplot(aes(x=Attendance, y=as.factor(streak)))+
  geom_boxplot()+
    labs(y="Win Streak")) |
(all_logs %>%
  ggplot(aes(x=streak, y=Attendance))+
  geom_point()+
  geom_smooth()+
   labs(x="Win Streak"))
cor(all_logs$Attendance, all_logs$streak)
```

```{r twins_visitingteams}
twins_logs %>%
  ggplot(aes(x=Attendance, y=VisitingTeam))+
  geom_boxplot()
```

```{r weather_data}

```